;define(function(require){'use strict';var l=require('backbone'),i=require('underscore'),s=require('root/config'),$=require('jquery'),a=require('theme/leaflet/leaflet'),n=require('theme/js/map/map-model');return l.Model.extend({defaults:{id:'',default_data:{},map_data:null,map_leaflet:null,},initialize:function(){i.bindAll(this,'update','saveCurrentData')},initMap:function(){if(!this.isMapActive()&&$('#'+this.get('id')).length){this.set('map_data',new n(i.extend({id:this.get('id')},this.get('default_data'))));this.get('map_data').fetch();this.remove();var t=[this.get('map_data').get('center').lat,this.get('map_data').get('center').lng];this.set('map_leaflet',a.map(this.get('id')).setView(t,this.get('map_data').get('zoom')));a.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{zoom:this.get('map_data').get('zoom'),attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(this.get('map_leaflet'));this.get('map_leaflet').on('zoomend',this.saveCurrentData);this.get('map_leaflet').on('moveend',this.saveCurrentData);this.get('map_leaflet').on('unload',this.saveCurrentData)}},update:function(){if(!this.isMapActive()){this.initMap()};var t=new a.LatLng(this.get('map_data').get('center').lat,this.get('map_data').get('center').lng);this.get('map_leaflet').panTo(t);this.get('map_leaflet').setZoom(this.get('map_data').get('zoom'))},remove:function(){var t=$('#'+this.get('id'));if(t.length&&t.html().length){this.get('map_leaflet').remove();t.html('')};this.set('map_leaflet',null)},saveCurrentData:function(){var t=this.get('map_leaflet').getCenter();this.get('map_data').set('center',{lat:t.lat,lng:t.lng});this.get('map_data').set('zoom',this.get('map_leaflet').getZoom());this.get('map_data').save()},isMapActive:function(){var t=$('#'+this.get('id'));return this.get('map_leaflet')!==null&&t.length&&t.html().length}})});