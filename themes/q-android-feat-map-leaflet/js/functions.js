;define(['jquery','core/theme-app','core/modules/storage','core/theme-tpl-tags','root/config','theme/js/moment.min','theme/js/velocity.min','theme/js/jquery.fitvids','theme/js/map/map-run'],function($,t,n,o,s,c,G){t.setParam('go-to-default-route-after-refresh',!1);t.setParam('custom-screen-rendering',!0);if(s.app_platform!=='pwa'){try{StatusBar.backgroundColorByHexString('#212121')}catch(X){console.log('StatusBar plugin not available - you\'re probably in the browser')}};var u=!1,a=!1,i=[],r,f,U='',g=$('#slideup-panel'),v=$('#app-canvas'),y='<svg class="spinner" width="66px" height="66px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="20"></circle></svg>';t.filter('template-args',function(e,t,n){if(t=='single'||t=='page'||t=='archive'){e.getCustomDate=function(e){var r=o.getGmtOffset()*3600,a=c(),t=c(new Date((e-r)*1000)),i=a.diff(t,'days'),n;if(i==0){n=t.fromNow()}else{n=t.format('MMMM Do YYYY')};return n}}else if(n==='menu'){e.Config=s};return e});var d='';t.filter('make-history',function(e,t,n,o,r){if(n.screen_type==='single'&&o.screen_type==='single'){if((n.item_id!==r.item_id)){e='push'}else{e='pop'}};d=e;return e});t.filter('transition-direction',function(e,t,n){if(t.screen_type==='single'&&n.screen_type==='single'){if(d==='push'){e='next-screen'}else{e='previous-screen'}};return e});t.filter('transition-direction',function(e,t,n){if(n.screen_type==='single'&&_.isEmpty(t)){e='next-screen'};return e});t.action('screen-transition',function(e,n,o,r,a,i){var s=t.getTransitionDirection(r,a);switch(s){case'next-screen':transition_next_screen(e,n,o,r,a,i);break;case'previous-screen':transition_previous_screen(e,n,o,r,a,i);break;case'default':transition_default(e,n,o,r,a,i);break;default:transition_default(e,n,o,r,a,i);break}});transition_next_screen=function(e,t,o,a,i,s){r=R();var c=m(r);f=V(c);f.append(o);if(a.screen_type=='list'){n.set('scroll-pos',a.fragment,t.scrollTop())};r.velocity({top:'0px',opacity:1},{display:'block',duration:300,complete:function(){s.resolve()}})};transition_previous_screen=function(e,t,o,i,a,s){r.velocity({top:'100px',opacity:0},{queue:!1,duration:200,display:'none',complete:function(){e.empty().append(o);f.empty();if(a.screen_type=='list'){var t=n.get('scroll-pos',a.fragment);if(t!==null){o.scrollTop(t)}else{o.scrollTop(0)}};h(r);s.resolve()}})};transition_default=function(e,t,n,o,a,i){t.remove();e.empty().append(n);if(r){h(r)};i.resolve()};t.on('refresh:start',function(){$('#refresh-button').removeClass('refresh-off').addClass('refresh-on')});t.on('refresh:end',function(o){t.navigateToDefaultRoute();n.clear('scroll-pos');$('#refresh-button').removeClass('refresh-on').addClass('refresh-off');$('#menu-items li').removeClass('menu-active-item');$('#menu-items li:first-child').addClass('menu-active-item');if(o.ok){l('Content updated successfully')}else{l(o.message)}});t.on('info:load-item-from-remote:start',function(){$('#refresh-button').hide();$('.loading-from-remote-button').show()});t.on('info:load-item-from-remote:stop',function(){$('.loading-from-remote-button').hide();$('#refresh-button').show()});t.on('error',function(e){l(e.message)});t.on('screen:showed',function(n,o){var r=t.getCurrentScreenObject();if(u){$('#app-canvas').css('left','85%');p()};if(n.screen_type=='list'){if($('#app-header > h1').html()!=n.label){$('#app-header > h1').html(n.label)}};if(n.screen_type=='page'){if($('#app-header > h1').html()!=''){$('#app-header > h1').html('')}};if(n.screen_type=='single'||n.screen_type=='page'){L(r);P(r)}});t.on('screen:leave',function(t,n,o){var a=m(r);if(t.screen_type==='single'){$('#'+a+' iframe').remove()}});t.on('network:online',function(e){var t=o.getNetworkState(!0);l(t)});t.on('network:offline',function(e){var t=o.getNetworkState(!0);l(t)});$('#app-layout').on('touchstart mousedown','#menu-button',k);$('#app-layout').on('touchend click','#menu-button',T);$('#app-layout').on('touchstart mousedown','#refresh-button',q);$('#app-layout').on('touchend click','#refresh-button',M);$('#app-layout').on('touchstart mousedown','#menu-items li a',C);$('#app-layout').on('touchend click','#menu-items li a',D);$('#app-layout').on('touchstart','#content .content-item a',S);$('#app-layout').on('click','#content .content-item a',x);$('#app-layout').on('touchstart mousedown','#back-button',B);$('#app-layout').on('touchend click','#back-button',I);$('#app-layout').on('click touchend','#single-content .content-image-link',function(e){e.preventDefault()});$('#app-layout').on('touchstart mousedown','#get-more-button',Y);$('#app-layout').on('touchend click','#get-more-button',A);$('#app-layout').on('touchstart','.has-ripple-feedback',E);$('#app-layout').on('touchend','.has-ripple-feedback',H);$('#app-layout').on('click','.single-content a',N);window.displayDefaultImage=function(t){$(t).attr('src',o.getThemeAssetUrl('img/img-icon.svg'))};function b(){$('#menu-items').css('display','block');$('#app-canvas').velocity({left:'85%',},{duration:300,complete:function(){setTimeout(function(){u=!0},150)}})};function p(n,o){u=!1;$('#app-canvas').velocity({left:'0',},{duration:300,complete:function(){$('#menu-items').css('display','none');if(n==1){t.navigate(o.attr('href'))}}})};function w(){if(u){p()}else{b()}};function k(e){e.preventDefault();a=!0};function T(e){e.preventDefault();w()};function C(e){a=!0};function D(t){t.preventDefault();if(u){$('#menu-items li').removeClass('menu-active-item');$(this).closest('li').addClass('menu-active-item');p(1,$(this))}};function x(n){n.preventDefault();if(!u){t.navigate($(this).attr('href'))}else{p()}};function S(e){a=!0};function l(t,n){var n=typeof n!=='undefined'?n:!0;$('#app-message-bar').velocity({opacity:.9},{queue:!1,display:'block',duration:250,begin:function(){$('#app-message-bar').html(t)},complete:function(){}});if(n===!0){setTimeout(j,3000)}};function j(){$('#app-message-bar').velocity({opacity:0},{queue:!1,display:'none',duration:250,begin:function(){},complete:function(){$('#app-message-bar').html('')}})};function q(e){e.preventDefault();a=!0};function M(e){e.preventDefault();if(!t.isRefreshing()){t.refresh()}};function W(){$('#refresh-button').removeClass('refresh-on').addClass('refresh-off')};function Y(e){a=!0};function A(n){n.preventDefault();$('#get-more-button').attr('disabled','disabled');$('#get-more-button').append(y);t.getMoreComponentItems(function(){$('#get-more-button .spinner').remove();$('#get-more-button').removeAttr('disabled')},function(t,n){$('#get-more-button .spinner').remove();$('#get-more-button').removeAttr('disabled')})};function B(e){e.preventDefault();a=!0};function I(e){e.preventDefault();t.navigate(o.getPreviousScreenLink())};function L(t){$('.single-template blockquote.twitter-tweet p').css('display','inline-block');$('.wpak-content-not-available').html('Content unavailable')};function N(n){n.preventDefault();var r=$(n.target),o=r.attr('href');if(o.charAt(0)!=='#'){try{cordova.InAppBrowser.open(o,'_system','location=yes')}catch(a){window.open(o,'_blank','location=yes')}}else{if(!r.hasClass('q-theme-prevent-navigation')){t.navigate(o)}}};function P(t){if(t.screen_type==='single'){var n=m(r);$('#'+n+' iframe').each(function(t){if($(this).attr('data-src')){$(this).attr('src',$(this).attr('data-src'))}});$('#'+n+' #single-content').fitVids()};if(t.screen_type==='page'){$('iframe').each(function(t){if($(this).attr('data-src')){$(this).attr('src',$(this).attr('data-src'))}});$('#single-content').fitVids()}};function E(t){if(a===!0){$currentTarget=$(t.currentTarget);$currentTarget.prepend('<span class="ripple-drop"></span>');var n=$currentTarget.find('.ripple-drop'),o;if($currentTarget.hasClass('ripple-small')){o=56}else{o=Math.max($currentTarget.outerWidth(),$currentTarget.outerHeight())};n.css({'width':o,'height':o});var i=$currentTarget.height();if($currentTarget.css('overflow')!='hidden'){$currentTarget.css('height',i+'px');$currentTarget.css('overflow','hidden')};var r;r=O(t);n.css({'top':(r.tapTop-$currentTarget.offset().top)-n.width()/2,'left':(r.tapLeft-$currentTarget.offset().left)-(n.width()/2)});n.velocity({scaleX:2.5,scaleY:2.5,opacity:0},{duration:600,easing:'linear',complete:function(){n.remove()}})}};function H(e){a=!1};function O(e){var t,n;t=e.originalEvent.touches[0];n={tapLeft:t.pageX,tapTop:t.pageY};return n};function R(){var e=i.length;i[e]=g.clone();i[e].attr('id','slideup-panel-'+e);v.append(i[e]);return i[e]};function m(t){return $(t).attr('id')};function V(t){var n=$('#'+t+' .panel-content');return n};function h(e){e.remove();i.pop();var t=i.length;if(t>0){r=i[t-1]}}});