;define(function(require){'use strict';var i=require('backbone'),u=require('root/config'),r=require('underscore');require('localstorage');var a=i.Model.extend({defaults:{id:'',group:'',key:'',value:''}});var o=i.Collection.extend({localStorage:new i.LocalStorage('Storage-'+u.app_slug),model:a,resetAll:function(){var n=this.length;for(var e=n-1;e>=0;e--){this.at(e).destroy()};this.reset()}});var e=new o();e.fetch();var t={};t.set=function(n,t,r){if(n!==undefined&&t!==undefined&&r!==undefined){var i=e.add({id:n+':'+t,group:n,key:t,value:r},{merge:!0});i.save()}};t.get=function(n,i,o){var t=null,u=e.where({group:n});if(!r.isEmpty(u)){if(i!==undefined){var a=e.get(n+':'+i);if(a){t=a.get('value')}else if(o!==undefined){t=o}}else{t={};r.each(u,function(e){t[e.get('key')]=e.get('value')})}}else if(i!==undefined&&o!==undefined){t=o};return t};t.clear=function(n,t){var o=e.where({group:n});if(!r.isEmpty(o)){if(t!==undefined){var i=e.get(n+':'+t);if(i){i.destroy();e.remove(n+':'+t)}}else{r.each(o,function(n){var t=n.get('group')+':'+n.get('key'),r=e.get(t);r.destroy();e.remove(t)})}}};t.clearAll=function(){e.resetAll()};return t});