;define(function(require){'use strict';var o=require('backbone'),r=require('root/config'),u=require('underscore');require('localstorage');var a=o.Model.extend({localStorage:new o.LocalStorage('Stats-'+r.app_slug),defaults:{id:'',current_version:'',last_version:'',count_open:0,last_open_time:0,current_open_time:0,last_sync:0}});var e=new a();e.fetch();var i=function(t){var e=new Date(t),s=e.getFullYear(),a=e.getMonth()+1;a=a<10?'0'+a:a;var i=e.getDate();i=i<10?'0'+i:i;var o=e.getHours();o=o<10?'0'+o:o;var r=e.getMinutes();r=r<10?'0'+r:r;var n=e.getSeconds();n=n<10?'0'+n:n;return s+'-'+a+'-'+i+' '+o+':'+r+':'+n};function s(r,s,o){var i=o&&o.lexicographical,u=o&&o.zeroExtend,e=r.split('.'),t=s.split('.');function a(e){return(i?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)};if(!e.every(a)||!t.every(a)){return NaN};if(u){while(e.length<t.length)e.push('0');while(t.length<e.length)t.push('0')};if(!i){e=e.map(Number);t=t.map(Number)};for(var n=0;n<e.length;++n){if(t.length==n){return 1};if(e[n]==t[n]){continue}else if(e[n]>t[n]){return 1}else{return-1}};if(e.length!=t.length){return-1};return 0};var n={getStats:function(t){var e={};e.count_open=n.getCountOpen();e.last_open_date=n.getLastOpenDate();e.version_diff=n.getVersionDiff();e.version=e.version_diff.current_version;e.last_sync=n.getContentLastUpdated();if(t!==undefined&&e.hasOwnProperty(t)){e=e[t]};return e},incrementCountOpen:function(){e.set('count_open',e.get('count_open')+1);e.save()},getCountOpen:function(){return e.get('count_open')},incrementLastOpenTime:function(){e.set('last_open_time',e.get('current_open_time'));e.set('current_open_time',new Date().getTime());e.save()},getLastOpenDate:function(){return i(e.get('last_open_time'))},updateVersion:function(){var t=e.get('current_version');e.set('last_version',t!=''?t:r.version);e.set('current_version',r.version);e.save()},getVersionDiff:function(){var t=e.get('current_version'),n=e.get('last_version'),r=s(t,n,{lexicographical:!1,zeroExtend:!0});return{current_version:t,last_version:n,diff:r}},getContentLastUpdated:function(){return e.get('last_sync')},incrementContentLastUpdate:function(){e.set('last_sync',Date.now());e.save()}};return n});