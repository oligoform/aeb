;define(function(require,exports){'use strict';var a=require('underscore'),u=require('root/config'),n=require('core/app'),s=require('core/region-manager'),f=require('core/stats'),c=require('core/addons-internal'),o=require('core/theme-app'),d=require('core/app-dynamic-data'),p=require('core/lib/hooks'),g=require('core/app-utils'),e={};e.getCurrentScreen=function(){return n.getCurrentScreenData()};e.getCurrentScreenObject=function(){return o.getCurrentScreenObject()};e.getPreviousScreen=function(){return n.getPreviousScreenData()};e.isDefaultScreen=function(e){var t='undefined'!=typeof e&&e.hasOwnProperty('fragment')?e.fragment:Backbone.history.fragment,r=n.getParam('use-html5-pushstate')?'':'#';t=r+t;return t.length===0||n.router.getDefaultRoute()==t};e.getCurrentTemplate=function(){var e='',t=s.getCurrentView();if(t){e=t.template_name};return e};e.getPreviousScreenLink=function(){return n.getPreviousScreenLink()};e.getPostLink=function(e,t){var r=n.getCurrentScreenGlobal(t);return r!==''?n.getScreenFragment('single',{global:r,item_id:e}):''};e.getCommentsLink=function(e){return n.getScreenFragment('comments',{item_id:e})};e.getDefaultRouteLink=function(){return n.router.getDefaultRoute()};e.isSingle=function(e,t,r){var o=t!==undefined&&!a.isEmpty(t)?t:n.getCurrentScreenData();r=r!==undefined?r:'posts';var i=o.screen_type=='single'&&o.global==r;if(i&&e!=undefined&&e!=''&&e!=0){i=parseInt(e)==o.item_id};return i==!0};e.isPostType=function(e,t,a){var i=a!==undefined?a:n.getCurrentScreenData(),r=(i.screen_type=='single');if(r&&e!=undefined){r=(i.data.post.post_type==e);if(r&&t!=undefined&&t!=''&&t!=0){r=r&&(parseInt(t)==i.item_id)}};return r==!0};e.isTaxonomy=function(e,t,i){var r=!1,u=i!==undefined?i:n.getCurrentScreenData();if(!a.isEmpty(u.data)&&!a.isEmpty(u.data.query)){var o=u.data.query;r=u.screen_type=='list'&&!a.isEmpty(o.type)&&o.type=='taxonomy';if(r&&!a.isEmpty(e)){r=!a.isEmpty(o.taxonomy)&&o.taxonomy==e;if(r&&!a.isEmpty(t)){if(typeof t==='string'){t=[t]};r=r&&!a.isEmpty(a.intersection(t,o.terms))}}};return r};e.isCategory=function(t,n){return e.isTaxonomy('category',t,n)};e.isTag=function(t,n){return e.isTaxonomy('tag',t,n)};e.isScreen=function(e,t){var r=t!==undefined?t:n.getCurrentScreenData();return r.fragment==e};e.displayBackButton=function(){var e=o.getBackButtonDisplay();return e=='show'};e.displayGetMoreLink=function(){var e=o.getGetMoreLinkDisplay();return e.display};e.getMoreLinkNbLeft=function(){var e=o.getGetMoreLinkDisplay();return e.nb_left};e.getComponent=function(e){return n.getComponentData(e)};e.componentExists=function(e){return n.componentExists(e)};e.getComponentLink=function(e){var t=n.getScreenFragment('component',{component_id:e});return t};e.isComponent=function(e){return e.length>0&&o.getCurrentComponentId()===e};e.getComponentItems=function(t,n){n=n===undefined?'view_items':n;var r=[],a=e.getComponent(t);if(a){if(n==='view_items'||n==='json'){if(a.view_data.hasOwnProperty('posts')){r=a.view_data.posts}else if(a.view_data.hasOwnProperty('items')){r=a.view_data.items};if(n==='json'){r=r.map(function(e){return e.toJSON()})}}};return r};e.formatDate=function(e,t){if(t==undefined){t='d/m/Y'};var r=new Date(e*1000),n=r.getUTCMonth()+1;n=n<10?'0'+n:n;var a=r.getUTCDate(),i=r.getUTCFullYear();t=t.replace('d',a);t=t.replace('m',n);t=t.replace('Y',i);return t};e.getThemePath=function(){return'themes/'+u.theme};e.getThemeAssetUrl=function(t,n){if(n===undefined){n=u.debug_mode==='on'&&u.app_type!=='pwa'}else{n=n===!0};var a=window.location.search.substring(1);if(a.length){var r=a.split('='),o=r[0],s=r[1];t=g.addParamToUrl(t,o,s)};if(n){var i=new Date().getTime();t=g.addParamToUrl(t,'bust',i)};t=e.getThemePath()+'/'+t;return t};e.getMenuItems=function(){var e=[],t=s.getMenuView();if(t){e=t.menu.toJSON()};return e};e.isComponentInMenu=function(e){var t=!1,n=s.getMenuView();if(n){t=n.menu.get(e)!==undefined};return t};e.addonIsActive=function(e){return c.isActive(e)};e.isPage=function(e,t){var a=t!==undefined?t:n.getCurrentScreenData(),r=a.screen_type=='page';if(r&&e!=undefined){r=parseInt(e)==a.item_id};return r==!0};e.isTreePage=function(e){var t=e!==undefined?e:n.getCurrentScreenData(),r=t.screen_type=='page'&&t.data.is_tree_page;return r==!0};var i=function(e,t){var r=t!==undefined?t:n.getCurrentScreenData(),a='',i=r.data.post&&r.data.post.tree_data?r.data.post.tree_data:[0,[],[],0,[]],f=r.data.is_tree_page&&!r.data.is_tree_root?i[0]:0,c=r.data.is_tree_page&&!r.data.is_tree_root?i[1]:[],d=r.data.is_tree_page?i[2]:[],p=r.data.is_tree_page?i[3]-r.data.root_depth:0,s=[];if(r.data.is_tree_page){var u=i[4],g=u.indexOf(r.data.root_id);if(g>-1){for(var o=g;o<u.length;o++){s.push(u[o])}}};if(i.length){if(e!=undefined){switch(e){case'parent':a=f;break;case'siblings':a=c;break;case'children':a=d;break;case'depth':a=p;break;case'ariane':a=s;break}}else{a={'parent':f,'siblings':c,'children':d,'depth':p,'ariane':s}}};return a};e.getPageParent=function(t){var a=null;if(e.isTreePage(t)){var r=i('parent',t);if(r>0){a=n.getGlobalItem('pages',r)}};return a};e.getPageSiblings=function(t){var a=[];if(e.isTreePage(t)){var r=i('siblings',t);if(r.length){a=n.getGlobalItems('pages',r)}};return a};e.getNextPage=function(t){var o=null;if(e.isTreePage(t)){var u=t!==undefined?t:n.getCurrentScreenData(),r=i('siblings',t),a=r.indexOf(u.item_id);if(a!=-1&&a<(r.length-1)){o=n.getGlobalItem('pages',r[a+1])}};return o};e.getPreviousPage=function(t){var o=null;if(e.isTreePage(t)){var u=t!==undefined?t:n.getCurrentScreenData(),a=i('siblings',t),r=a.indexOf(u.item_id);if(r!=-1&&r>0){o=n.getGlobalItem('pages',a[r-1])}};return o};e.getPageChildren=function(t){var a=[];if(e.isTreePage(t)){var r=i('children',t);if(r.length){a=n.getGlobalItems('pages',r)}};return a};e.getPageDepth=function(t){var n=0;if(e.isTreePage(t)){n=i('depth',t)};return n};e.getPageBreadcrumb=function(t){var a=[];if(e.isTreePage(t)){var r=i('ariane',t);if(r.length){a=n.getGlobalItems('pages',r)}};return a};e.getPageLink=function(e,t,r){var i='';if(a.isEmpty(t)){var o=r!==undefined?r:n.getCurrentScreenData();t=o.component_id};i=n.getScreenFragment('page',{component_id:t,item_id:e});return i};e.getNetworkState=function(e){return o.getNetworkState(e)};e.getAppStats=function(e){return f.getStats(e)};e.getPostDataAttributes=function(e){var t=['data-id="'+e+'"','data-global="'+n.getPostGlobal(e)+'"'];t=p.applyFilters('post-data-attributes',t,[e]);return t.join(' ')};e.isComponentTypeLoaded=function(e){var t=n.components.where({type:e});return t.length>0};e.getGmtOffset=function(){var e=d.getDynamicData('gmt_offset');if(e===undefined){e=u.gmt_offset};return e};a.extend(exports,e)});