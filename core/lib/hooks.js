;define(function(require){'use strict';var $=require('jquery'),i=require('underscore'),t={};var n={};var r={};var o=function(e){var r=0,n,i,t;if(e.length==0)return r;for(n=0,t=e.length;n<t;n++){i=e.charCodeAt(n);r=((r<<5)-r)+i;r|=0};return r},a=function(e){return o(e.toString())};t.applyFilters=function(e,r,t,o){if(n.hasOwnProperty(e)){var a=n[e];a=i.sortBy(a,function(e){return e.priority});t.unshift(r);for(var c=0;c<a.length;c++){r=a[c].callback.apply(o,t);t.shift();t.unshift(r)}};return r};t.addFilter=function(e,i,r){if(r===undefined){r=10};var t={callback:i,priority:r,callback_id:a(i)};if(!n.hasOwnProperty(e)){n[e]=[t]}else{n[e].push(t)}};t.removeFilter=function(e,r,t){if(n.hasOwnProperty(e)){if(r===undefined){delete n[e]}else{var c=n[e],o=a(r);if(t===undefined){c=i.reject(c,function(e){return e.callback_id==o})}else{c=i.reject(c,function(e){return e.callback_id==o&&e.priority==t})};n[e]=c}}};t.doActions=function(n,t,e,u){e=(e===undefined||!i.isObject(e))?{}:e;var f=$.Deferred();if(r.hasOwnProperty(n)){var a=r[n];a=i.sortBy(a,function(e){return e.priority});var d=[];for(var o=0;o<a.length;o++){var l=$.Deferred();d.push(l);t.push(l);t.push(e);e=a[o].callback.apply(u,t);if(e!==undefined&&i.isObject(e)){if(e.break_actions&&e.break_actions===!0){break}};t.pop();t.pop()};$.when.apply($,d).done(function(){f.resolve(e)})}else{f.resolve(e)};return f.promise()};t.addAction=function(e,i,n){if(n===undefined){n=10};var t={callback:i,priority:n,callback_id:a(i)};if(!r.hasOwnProperty(e)){r[e]=[t]}else{r[e].push(t)}};t.removeAction=function(e,n,t){if(r.hasOwnProperty(e)){if(n===undefined){delete r[e]}else{var c=r[e],o=a(n);if(t===undefined){c=i.reject(c,function(e){return e.callback_id==o})}else{c=i.reject(c,function(e){return e.callback_id==o&&e.priority==t})};r[e]=c}}};return t});