(function(t){var e=typeof self=='object'&&self.self===self&&self||typeof global=='object'&&global.global===global&&global;if(typeof define==='function'&&define.amd){define(['underscore','jquery','exports'],function(i,n,s){e.Backbone=t(e,s,i,n)})}else if(typeof exports!=='undefined'){var n=require('underscore'),i;try{i=require('jquery')}catch(s){};t(e,exports,n,i)}else{e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}})(function(e,i,t,s){var z=e.Backbone,x=Array.prototype.slice;i.VERSION='1.3.3';i.$=s;i.noConflict=function(){e.Backbone=z;return this};i.emulateHTTP=!1;i.emulateJSON=!1;var B=function(e,i,n){switch(e){case 1:return function(){return t[i](this[n])};case 2:return function(e){return t[i](this[n],e)};case 3:return function(e,s){return t[i](this[n],b(e,this),s)};case 4:return function(e,s,r){return t[i](this[n],b(e,this),s,r)};default:return function(){var e=x.call(arguments);e.unshift(this[n]);return t[i].apply(t,e)}}},y=function(e,i,n){t.each(i,function(i,s){if(t[s])e.prototype[s]=B(i,s,n)})},b=function(e,i){if(t.isFunction(e))return e;if(t.isObject(e)&&!i._isModel(e))return J(e);if(t.isString(e))return function(t){return t.get(e)};return e},J=function(e){var i=t.matches(e);return function(t){return i(t.attributes)}},n=i.Events={};var m=/\s+/,a=function(e,i,n,s,r){var h=0,o;if(n&&typeof n==='object'){if(s!==void 0&&'context'in r&&r.context===void 0)r.context=s;for(o=t.keys(n);h<o.length;h++){i=a(e,i,o[h],n[o[h]],r)}}else if(n&&m.test(n)){for(o=n.split(m);h<o.length;h++){i=e(i,o[h],s,r)}}else{i=e(i,n,s,r)};return i};n.on=function(t,e,i){return p(this,t,e,i)};var p=function(t,e,i,n,s){t._events=a(q,t._events||{},e,i,{context:n,ctx:t,listening:s});if(s){var r=t._listeners||(t._listeners={});r[s.id]=s};return t};n.listenTo=function(e,i,n){if(!e)return this;var r=e._listenId||(e._listenId=t.uniqueId('l')),a=this._listeningTo||(this._listeningTo={});var s=a[r];if(!s){var h=this._listenId||(this._listenId=t.uniqueId('l'));s=a[r]={obj:e,objId:r,id:h,listeningTo:a,count:0}};p(e,i,n,this,s);return this};var q=function(t,e,i,n){if(i){var a=t[e]||(t[e]=[]),r=n.context,h=n.ctx,s=n.listening;if(s)s.count++;a.push({callback:i,context:r,ctx:r||h,listening:s})};return t};n.off=function(t,e,i){if(!this._events)return this;this._events=a(F,this._events,t,e,{context:i,listeners:this._listeners});return this};n.stopListening=function(e,i,n){var r=this._listeningTo;if(!r)return this;var h=e?[e._listenId]:t.keys(r);for(var s=0;s<h.length;s++){var a=r[h[s]];if(!a)break;a.obj.off(i,n,this)};return this};var F=function(e,i,n,r){if(!e)return;var a=0,s,f=r.context,o=r.listeners;if(!i&&!n&&!f){var g=t.keys(o);for(;a<g.length;a++){s=o[g[a]];delete o[s.id];delete s.listeningTo[s.objId]};return};var d=i?[i]:t.keys(e);for(;a<d.length;a++){i=d[a];var c=e[i];if(!c)break;var l=[];for(var u=0;u<c.length;u++){var h=c[u];if(n&&n!==h.callback&&n!==h.callback._callback||f&&f!==h.context){l.push(h)}else{s=h.listening;if(s&&--s.count===0){delete o[s.id];delete s.listeningTo[s.objId]}}};if(l.length){e[i]=l}else{delete e[i]}};return e};n.once=function(e,i,n){var s=a(v,{},e,i,t.bind(this.off,this));if(typeof e==='string'&&n==null)i=void 0;return this.on(s,i,n)};n.listenToOnce=function(e,i,n){var s=a(v,{},i,n,t.bind(this.stopListening,this,e));return this.listenTo(e,s)};var v=function(e,i,n,s){if(n){var r=e[i]=t.once(function(){s(i,r);n.apply(this,arguments)});r._callback=n};return e};n.trigger=function(t){if(!this._events)return this;var i=Math.max(0,arguments.length-1),n=Array(i);for(var e=0;e<i;e++)n[e]=arguments[e+1];a(U,this._events,t,void 0,n);return this};var U=function(t,e,i,n){if(t){var r=t[e],s=t.all;if(r&&s)s=s.slice();if(r)g(r,n);if(s)g(s,[e].concat(n))};return t},g=function(t,e){var i,n=-1,s=t.length,r=e[0],a=e[1],h=e[2];switch(e.length){case 0:while(++n<s)(i=t[n]).callback.call(i.ctx);return;case 1:while(++n<s)(i=t[n]).callback.call(i.ctx,r);return;case 2:while(++n<s)(i=t[n]).callback.call(i.ctx,r,a);return;case 3:while(++n<s)(i=t[n]).callback.call(i.ctx,r,a,h);return;default:while(++n<s)(i=t[n]).callback.apply(i.ctx,e);return}};n.bind=n.on;n.unbind=n.off;t.extend(i,n);var h=i.Model=function(e,i){var n=e||{};i||(i={});this.cid=t.uniqueId(this.cidPrefix);this.attributes={};if(i.collection)this.collection=i.collection;if(i.parse)n=this.parse(n,i)||{};var s=t.result(this,'defaults');n=t.defaults(t.extend({},s,n),s);this.set(n,i);this.changed={};this.initialize.apply(this,arguments)};t.extend(h.prototype,n,{changed:null,validationError:null,idAttribute:'id',cidPrefix:'c',initialize:function(){},toJSON:function(e){return t.clone(this.attributes)},sync:function(){return i.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(e){return t.escape(this.get(e))},has:function(t){return this.get(t)!=null},matches:function(e){return!!t.iteratee(e,this)(this.attributes)},set:function(e,i,n){if(e==null)return this;var r;if(typeof e==='object'){r=e;n=i}else{(r={})[e]=i};n||(n={});if(!this._validate(r,n))return!1;var d=n.unset,l=n.silent,a=[],c=this._changing;this._changing=!0;if(!c){this._previousAttributes=t.clone(this.attributes);this.changed={}};var o=this.attributes,u=this.changed,f=this._previousAttributes;for(var s in r){i=r[s];if(!t.isEqual(o[s],i))a.push(s);if(!t.isEqual(f[s],i)){u[s]=i}else{delete u[s]};d?delete o[s]:o[s]=i};if(this.idAttribute in r)this.id=this.get(this.idAttribute);if(!l){if(a.length)this._pending=n;for(var h=0;h<a.length;h++){this.trigger('change:'+a[h],this,o[a[h]],n)}};if(c)return this;if(!l){while(this._pending){n=this._pending;this._pending=!1;this.trigger('change',this,n)}};this._pending=!1;this._changing=!1;return this},unset:function(e,i){return this.set(e,void 0,t.extend({},i,{unset:!0}))},clear:function(e){var i={};for(var n in this.attributes)i[n]=void 0;return this.set(i,t.extend({},e,{unset:!0}))},hasChanged:function(e){if(e==null)return!t.isEmpty(this.changed);return t.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?t.clone(this.changed):!1;var r=this._changing?this._previousAttributes:this.attributes,n={};for(var i in e){var s=e[i];if(t.isEqual(r[i],s))continue;n[i]=s};return t.size(n)?n:!1},previous:function(t){if(t==null||!this._previousAttributes)return null;return this._previousAttributes[t]},previousAttributes:function(){return t.clone(this._previousAttributes)},fetch:function(e){e=t.extend({parse:!0},e);var i=this,n=e.success;e.success=function(t){var s=e.parse?i.parse(t,e):t;if(!i.set(s,e))return!1;if(n)n.call(e.context,i,t,e);i.trigger('sync',i,t,e)};o(this,e);return this.sync('read',this,e)},save:function(e,i,n){var s;if(e==null||typeof e==='object'){s=e;n=i}else{(s={})[e]=i};n=t.extend({validate:!0,parse:!0},n);var h=n.wait;if(s&&!h){if(!this.set(s,n))return!1}else if(!this._validate(s,n)){return!1};var r=this,l=n.success,a=this.attributes;n.success=function(e){r.attributes=a;var i=n.parse?r.parse(e,n):e;if(h)i=t.extend({},s,i);if(i&&!r.set(i,n))return!1;if(l)l.call(n.context,r,e,n);r.trigger('sync',r,e,n)};o(this,n);if(s&&h)this.attributes=t.extend({},a,s);var u=this.isNew()?'create':n.patch?'patch':'update';if(u==='patch'&&!n.attrs)n.attrs=s;var c=this.sync(u,this,n);this.attributes=a;return c},destroy:function(e){e=e?t.clone(e):{};var i=this,s=e.success,r=e.wait,a=function(){i.stopListening();i.trigger('destroy',i,i.collection,e)};e.success=function(t){if(r)a();if(s)s.call(e.context,i,t,e);if(!i.isNew())i.trigger('sync',i,t,e)};var n=!1;if(this.isNew()){t.defer(e.success)}else{o(this,e);n=this.sync('delete',this,e)};if(!r)a();return n},url:function(){var e=t.result(this,'urlRoot')||t.result(this.collection,'url')||l();if(this.isNew())return e;var i=this.get(this.idAttribute);return e.replace(/[^\/]$/,'$&/')+encodeURIComponent(i)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},t.extend({},e,{validate:!0}))},_validate:function(e,i){if(!i.validate||!this.validate)return!0;e=t.extend({},this.attributes,e);var n=this.validationError=this.validate(e,i)||null;if(!n)return!0;this.trigger('invalid',this,n,t.extend(i,{validationError:n}));return!1}});var O={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};y(h,O,'attributes');var u=i.Collection=function(e,i){i||(i={});if(i.model)this.model=i.model;if(i.comparator!==void 0)this.comparator=i.comparator;this._reset();this.initialize.apply(this,arguments);if(e)this.reset(e,t.extend({silent:!0},i))},M={add:!0,remove:!0,merge:!0};var j={add:!0,remove:!1};var d=function(t,e,i){i=Math.min(Math.max(i,0),t.length);var s=Array(t.length-i),r=e.length,n;for(n=0;n<s.length;n++)s[n]=t[n+i];for(n=0;n<r;n++)t[n+i]=e[n];for(n=0;n<s.length;n++)t[n+r+i]=s[n]};t.extend(u.prototype,n,{model:h,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return i.sync.apply(this,arguments)},add:function(e,i){return this.set(e,t.extend({merge:!1},i,j))},remove:function(e,i){i=t.extend({},i);var s=!t.isArray(e);e=s?[e]:e.slice();var n=this._removeModels(e,i);if(!i.silent&&n.length){i.changes={added:[],merged:[],removed:n};this.trigger('update',this,i)};return s?n[0]:n},set:function(e,i){if(e==null)return;i=t.extend({},M,i);if(i.parse&&!this._isModel(e)){e=this.parse(e,i)||[]};var b=!t.isArray(e);e=b?[e]:e.slice();var r=i.at;if(r!=null)r=+r;if(r>this.length)r=this.length;if(r<0)r+=this.length+1;var o=[],h=[],v=[],l=[],c={};var m=i.add,w=i.merge,y=i.remove,u=!1,g=this.comparator&&r==null&&i.sort!==!1,E=t.isString(this.comparator)?this.comparator:null,n,s;for(s=0;s<e.length;s++){n=e[s];var a=this.get(n);if(a){if(w&&n!==a){var f=this._isModel(n)?n.attributes:n;if(i.parse)f=a.parse(f,i);a.set(f,i);v.push(a);if(g&&!u)u=a.hasChanged(E)};if(!c[a.cid]){c[a.cid]=!0;o.push(a)};e[s]=a}else if(m){n=e[s]=this._prepareModel(n,i);if(n){h.push(n);this._addReference(n,i);c[n.cid]=!0;o.push(n)}}};if(y){for(s=0;s<this.length;s++){n=this.models[s];if(!c[n.cid])l.push(n)};if(l.length)this._removeModels(l,i)};var p=!1,x=!g&&m&&y;if(o.length&&x){p=this.length!==o.length||t.some(this.models,function(t,e){return t!==o[e]});this.models.length=0;d(this.models,o,0);this.length=this.models.length}else if(h.length){if(g)u=!0;d(this.models,h,r==null?this.length:r);this.length=this.models.length};if(u)this.sort({silent:!0});if(!i.silent){for(s=0;s<h.length;s++){if(r!=null)i.index=r+s;n=h[s];n.trigger('add',n,this,i)};if(u||p)this.trigger('sort',this,i);if(h.length||l.length||v.length){i.changes={added:h,removed:l,merged:v};this.trigger('update',this,i)}};return b?e[0]:e},reset:function(e,i){i=i?t.clone(i):{};for(var n=0;n<this.models.length;n++){this._removeReference(this.models[n],i)};i.previousModels=this.models;this._reset();e=this.add(e,t.extend({silent:!0},i));if(!i.silent)this.trigger('reset',this,i);return e},push:function(e,i){return this.add(e,t.extend({at:this.length},i))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(e,i){return this.add(e,t.extend({at:0},i))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return x.apply(this.models,arguments)},get:function(t){if(t==null)return void 0;return this._byId[t]||this._byId[this.modelId(t.attributes||t)]||t.cid&&this._byId[t.cid]},has:function(t){return this.get(t)!=null},at:function(t){if(t<0)t+=this.length;return this.models[t]},where:function(t,e){return this[e?'find':'filter'](t)},findWhere:function(t){return this.where(t,!0)},sort:function(e){var i=this.comparator;if(!i)throw new Error('Cannot sort a set without a comparator');e||(e={});var n=i.length;if(t.isFunction(i))i=t.bind(i,this);if(n===1||t.isString(i)){this.models=this.sortBy(i)}else{this.models.sort(i)};if(!e.silent)this.trigger('sort',this,e);return this},pluck:function(t){return this.map(t+'')},fetch:function(e){e=t.extend({parse:!0},e);var n=e.success,i=this;e.success=function(t){var s=e.reset?'reset':'set';i[s](t,e);if(n)n.call(e.context,i,t,e);i.trigger('sync',i,t,e)};o(this,e);return this.sync('read',this,e)},create:function(e,i){i=i?t.clone(i):{};var s=i.wait;e=this._prepareModel(e,i);if(!e)return!1;if(!s)this.add(e,i);var r=this,n=i.success;i.success=function(t,e,i){if(s)r.add(t,i);if(n)n.call(i.context,t,e,i)};e.save(null,i);return e},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||'id']},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(e,i){if(this._isModel(e)){if(!e.collection)e.collection=this;return e};i=i?t.clone(i):{};i.collection=this;var n=new this.model(e,i);if(!n.validationError)return n;this.trigger('invalid',this,n.validationError,i);return!1},_removeModels:function(t,e){var a=[];for(var n=0;n<t.length;n++){var i=this.get(t[n]);if(!i)continue;var r=this.indexOf(i);this.models.splice(r,1);this.length--;delete this._byId[i.cid];var s=this.modelId(i.attributes);if(s!=null)delete this._byId[s];if(!e.silent){e.index=r;i.trigger('remove',i,this,e)};a.push(i);this._removeReference(i,e)};return a},_isModel:function(t){return t instanceof h},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);if(i!=null)this._byId[i]=t;t.on('all',this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);if(i!=null)delete this._byId[i];if(this===t.collection)delete t.collection;t.off('all',this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if(e){if((t==='add'||t==='remove')&&i!==this)return;if(t==='destroy')this.remove(e,n);if(t==='change'){var s=this.modelId(e.previousAttributes()),r=this.modelId(e.attributes);if(s!==r){if(s!=null)delete this._byId[s];if(r!=null)this._byId[r]=e}}};this.trigger.apply(this,arguments)}});var N={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};y(u,N,'models');var f=i.View=function(e){this.cid=t.uniqueId('view');t.extend(this,t.pick(e,R));this._ensureElement();this.initialize.apply(this,arguments)},C=/^(\S+)\s*(.*)$/,R=['model','collection','el','id','attributes','className','tagName','events'];t.extend(f.prototype,n,{tagName:'div',$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(t){this.undelegateEvents();this._setElement(t);this.delegateEvents();return this},_setElement:function(t){this.$el=t instanceof i.$?t:i.$(t);this.el=this.$el[0]},delegateEvents:function(e){e||(e=t.result(this,'events'));if(!e)return this;this.undelegateEvents();for(var s in e){var i=e[s];if(!t.isFunction(i))i=this[i];if(!i)continue;var n=s.match(C);this.delegate(n[1],n[2],t.bind(i,this))};return this},delegate:function(t,e,i){this.$el.on(t+'.delegateEvents'+this.cid,e,i);return this},undelegateEvents:function(){if(this.$el)this.$el.off('.delegateEvents'+this.cid);return this},undelegate:function(t,e,i){this.$el.off(t+'.delegateEvents'+this.cid,e,i);return this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(!this.el){var e=t.extend({},t.result(this,'attributes'));if(this.id)e.id=t.result(this,'id');if(this.className)e['class']=t.result(this,'className');this.setElement(this._createElement(t.result(this,'tagName')));this._setAttributes(e)}else{this.setElement(t.result(this,'el'))}},_setAttributes:function(t){this.$el.attr(t)}});i.sync=function(e,n,s){var a=A[e];t.defaults(s||(s={}),{emulateHTTP:i.emulateHTTP,emulateJSON:i.emulateJSON});var r={type:a,dataType:'json'};if(!s.url){r.url=t.result(n,'url')||l()};if(s.data==null&&n&&(e==='create'||e==='update'||e==='patch')){r.contentType='application/json';r.data=JSON.stringify(s.attrs||n.toJSON(s))};if(s.emulateJSON){r.contentType='application/x-www-form-urlencoded';r.data=r.data?{model:r.data}:{}};if(s.emulateHTTP&&(a==='PUT'||a==='DELETE'||a==='PATCH')){r.type='POST';if(s.emulateJSON)r.data._method=a;var u=s.beforeSend;s.beforeSend=function(t){t.setRequestHeader('X-HTTP-Method-Override',a);if(u)return u.apply(this,arguments)}};if(r.type!=='GET'&&!s.emulateJSON){r.processData=!1};var o=s.error;s.error=function(t,e,i){s.textStatus=e;s.errorThrown=i;if(o)o.call(s.context,t,e,i)};var h=s.xhr=i.ajax(t.extend(r,s));n.trigger('request',n,h,s);return h};var A={create:'POST',update:'PUT',patch:'PATCH','delete':'DELETE',read:'GET'};i.ajax=function(){return i.$.ajax.apply(i.$,arguments)};var $=i.Router=function(t){t||(t={});if(t.routes)this.routes=t.routes;this._bindRoutes();this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,T=/(\(\?)?:\w+/g,P=/\*\w+/g,H=/[\-{}\[\]+?.,\\\^$|#\s]/g;t.extend($.prototype,n,{initialize:function(){},route:function(e,n,s){if(!t.isRegExp(e))e=this._routeToRegExp(e);if(t.isFunction(n)){s=n;n=''};if(!s)s=this[n];var r=this;i.history.route(e,function(t){var a=r._extractParameters(e,t);if(r.execute(s,a,n)!==!1){r.trigger.apply(r,['route:'+n].concat(a));r.trigger('route',n,a);i.history.trigger('route',r,n,a)}});return this},execute:function(t,e,i){if(t)t.apply(this,e)},navigate:function(t,e){i.history.navigate(t,e);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=t.result(this,'routes');var e,i=t.keys(this.routes);while((e=i.pop())!=null){this.route(e,this.routes[e])}},_routeToRegExp:function(t){t=t.replace(H,'\\$&').replace(k,'(?:$1)?').replace(T,function(t,e){return e?t:'([^/?]+)'}).replace(P,'([^?]*?)');return new RegExp('^'+t+'(?:\\?([\\s\\S]*))?$')},_extractParameters:function(e,i){var n=e.exec(i).slice(1);return t.map(n,function(t,e){if(e===n.length-1)return t||null;return t?decodeURIComponent(t):null})}});var r=i.History=function(){this.handlers=[];this.checkUrl=t.bind(this.checkUrl,this);if(typeof window!=='undefined'){this.location=window.location;this.history=window.history}},E=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,S=/#.*$/;r.started=!1;t.extend(r.prototype,n,{interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,'$&/');return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname),e=t.slice(0,this.root.length-1)+'/';return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,'%2525'))},getSearch:function(){var t=this.location.href.replace(/#.*/,'').match(/\?.+/);return t?t[0]:''},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:''},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return t.charAt(0)==='/'?t.slice(1):t},getFragment:function(t){if(t==null){if(this._usePushState||!this._wantsHashChange){t=this.getPath()}else{t=this.getHash()}};return t.replace(E,'')},start:function(e){if(r.started)throw new Error('Backbone.history has already been started');r.started=!0;this.options=t.extend({root:'/'},this.options,e);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==!1;this._hasHashChange='onhashchange'in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=('/'+this.root+'/').replace(I,'/');if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var a=this.root.slice(0,-1)||'/';this.location.replace(a+'#'+this.getPath());return!0}else if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:!0})}};if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement('iframe');this.iframe.src='javascript:0';this.iframe.style.display='none';this.iframe.tabIndex=-1;var s=document.body,i=s.insertBefore(this.iframe,s.firstChild).contentWindow;i.document.open();i.document.close();i.location.hash='#'+this.fragment};var n=window.addEventListener||function(t,e){return attachEvent('on'+t,e)};if(this._usePushState){n('popstate',this.checkUrl,!1)}else if(this._useHashChange&&!this.iframe){n('hashchange',this.checkUrl,!1)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)};if(!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent('on'+t,e)};if(this._usePushState){t('popstate',this.checkUrl,!1)}else if(this._useHashChange&&!this.iframe){t('hashchange',this.checkUrl,!1)};if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null};if(this._checkUrlInterval)clearInterval(this._checkUrlInterval);r.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe){e=this.getHash(this.iframe.contentWindow)};if(e===this.fragment)return!1;if(this.iframe)this.navigate(e);this.loadUrl()},loadUrl:function(e){if(!this.matchRoot())return!1;e=this.fragment=this.getFragment(e);return t.some(this.handlers,function(t){if(t.route.test(e)){t.callback(e);return!0}})},navigate:function(t,e){if(!r.started)return!1;if(!e||e===!0)e={trigger:!!e};t=this.getFragment(t||'');var n=this.root;if(t===''||t.charAt(0)==='?'){n=n.slice(0,-1)||'/'};var s=n+t;t=this.decodeFragment(t.replace(S,''));if(this.fragment===t)return;this.fragment=t;if(this._usePushState){this.history[e.replace?'replaceState':'pushState']({},document.title,s)}else if(this._wantsHashChange){this._updateHash(this.location,t,e.replace);if(this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var i=this.iframe.contentWindow;if(!e.replace){i.document.open();i.document.close()};this._updateHash(i.location,t,e.replace)}}else{return this.location.assign(s)};if(e.trigger)return this.loadUrl(t)},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,'');t.replace(n+'#'+e)}else{t.hash='#'+e}}});i.history=new r;var w=function(e,i){var s=this,n;if(e&&t.has(e,'constructor')){n=e.constructor}else{n=function(){return s.apply(this,arguments)}};t.extend(n,s,i);n.prototype=t.create(s.prototype,e);n.prototype.constructor=n;n.__super__=s.prototype;return n};h.extend=u.extend=$.extend=f.extend=r.extend=w;var l=function(){throw new Error('A "url" property or function must be specified')},o=function(t,e){var i=e.error;e.error=function(n){if(i)i.call(e.context,t,n,e);t.trigger('error',t,n,e)}};return i});